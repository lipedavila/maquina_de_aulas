<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Revis√£o para Prova de F√≠sica B ‚Äî Edi√ß√£o Enriquecida</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$','$$'], ['\\[','\\]']],
        processEscapes: true
      },
      svg: { fontCache: 'global' }
    };
  </script>
  <script id="MathJax-script" defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

  <style>
    :root{
      --ink:#1b1f23; --muted:#4b5563; --accent:#1a2a6c; --accent2:#b21f1f; --paper:#ffffff; --border:#e5e7eb; --box:#f8fafc;
    }
    *{box-sizing:border-box}
    html,body{min-height:100%; background:linear-gradient(135deg,#1a2a6c,#b21f1f,#1a2a6c); color:var(--ink); font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif; line-height:1.4;}
    .container{max-width:1200px; margin:0 auto; padding:22px;}
    header{ text-align:center; padding:30px 20px; background:rgba(255,255,255,0.92); border-radius:15px; box-shadow:0 10px 30px rgba(0,0,0,.25); margin-bottom:26px;}
    h1{font-size:2.2rem; margin:0 0 6px; color:#1a2a6c; text-shadow:2px 2px 4px rgba(0,0,0,0.06);}
    .subtitle{color:#b21f1f; font-size:1.1rem; margin:4px 0 14px;}
    .exam-info{display:flex; justify-content:center; flex-wrap:wrap; gap:16px; margin-top:10px; background:rgba(26,42,108,0.08); padding:12px; border-radius:12px;}
    .info-card{background:#fff; padding:12px 14px; border-radius:10px; min-width:180px; box-shadow:0 4px 8px rgba(0,0,0,0.08);}  

    .toolbar{display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin:18px 0 0;}
    .btn{appearance:none; border:1px solid var(--border); background:#f3f4f6; padding:10px 14px; border-radius:10px; font-weight:600; cursor:pointer;}
    .btn:hover{filter:brightness(0.98);} .btn--accent{background:#e6fffa; border-color:#99f6e4;}

    .content{display:grid; grid-template-columns:1fr 1fr; gap:22px;}
    @media (max-width: 900px){ .content{grid-template-columns:1fr;} }

    section.section{background:rgba(255,255,255,0.96); border-radius:15px; padding:22px; box-shadow:0 8px 20px rgba(0,0,0,0.18); transition:transform .3s}
    section.section:hover{transform:translateY(-3px)}
    h2{color:#1a2a6c; border-bottom:3px solid #b21f1f; padding-bottom:8px; margin-bottom:16px; display:flex; align-items:center; gap:8px;}
    h3{color:#b21f1f; margin:18px 0 10px;}

    .concepts{padding:14px; background:rgba(26, 42, 108, 0.06); border-radius:10px;}
    .concept-item{margin-bottom:10px; padding-left:18px; position:relative}
    .concept-item:before{content:"‚Ä¢"; color:#b21f1f; position:absolute; left:0; top:0; font-weight:700}
    .highlight{background:linear-gradient(120deg, rgba(255,255,0,0.3), rgba(255,255,0,0)); padding:1px 5px; border-radius:3px}

    .example-question{background:#fff; border-left:5px solid #1a2a6c; padding:16px; margin:18px 0; border-radius:0 10px 10px 0; box-shadow:0 4px 10px rgba(0,0,0,0.08)}
    .question-text{font-weight:700; margin-bottom:12px; color:#1a2a6c}
    .solution{background:rgba(178,31,31,0.06); padding:12px; border-radius:8px; margin-top:10px}
    .step{margin-bottom:10px; display:flex; gap:12px}
    .step-number{background:#1a2a6c; color:#fff; width:28px; height:28px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:700; flex-shrink:0}
    
    /* Estilos para F√≥rmulas */
    .formula{background:rgba(26,42,108,0.1); padding:12px; border-radius:8px; margin:12px 0; text-align:center; font-size:1.1rem}
    .formula-inline { background-color: #eef2ff; color: #312e81; padding: 2px 6px; border-radius: 4px; font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 0.9em; }
    
    /* Estilos para Exerc√≠cios e IA */
    .exercise-item { border: 1px solid var(--border); border-radius: 10px; padding: 16px; background: #fff; margin-bottom:16px;}
    .k { display: inline-block; background: #111827; color: #fff; padding: 2px 8px; border-radius: 8px; font-size: 0.82rem; margin-right: 8px;}
    .q { font-weight: 700; margin-bottom: 12px; }
    .options-container label { display: block; margin: 8px 0; padding: 8px; border-radius: 6px; cursor: pointer; transition: background-color 0.2s; }
    .options-container label:hover { background-color: #f0f4ff; }
    .options-container input { margin-right: 10px; }
    .actions { display: flex; gap: 10px; margin-top: 12px; flex-wrap:wrap; }
    .btn-check, .btn-ai { appearance: none; border: 1px solid var(--border); padding: 8px 12px; border-radius: 8px; font-weight: 600; cursor: pointer; }
    .btn-check { background-color: #e0f2fe; color: #0c546e; }
    .btn-ai { background-color: #d1fae5; color: #065f46; }
    .feedback { margin-top: 12px; padding: 10px; border-radius: 6px; font-weight: 600; }
    .feedback.correct { background-color: #dcfce7; color: #166534; border-left: 4px solid #22c55e; }
    .feedback.incorrect { background-color: #fee2e2; color: #991b1b; border-left: 4px solid #ef4444; }
    .ai-explanation { margin-top: 12px; padding: 12px; border-radius: 8px; background: rgba(26,42,108,0.06); }
    .ai-explanation p b { color: var(--accent); }
    .ai-assistant-trigger { text-align: right; margin-top: 12px; }
    .btn-ai-context { background-color: #f3e8ff; color: #581c87; border: 1px solid #e9d5ff; padding: 6px 10px; border-radius: 8px; cursor:pointer; font-weight:600; font-size:0.9rem;}
    .btn-ai-context:hover { filter: brightness(0.97); }

    /* Modal do Assistente de IA */
    .ai-modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 15px;}
    .ai-modal-content { background: var(--paper); border-radius: 15px; padding: 25px; max-width: 600px; width:100%; box-shadow: 0 10px 40px rgba(0,0,0,0.3); position:relative; animation: modal-fadein 0.3s; }
    @keyframes modal-fadein { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
    .ai-modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); padding-bottom: 12px; margin-bottom: 15px;}
    .ai-modal-header h3 { margin: 0; color: var(--accent); }
    .ai-modal-close { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--muted); }
    .ai-modal-body textarea { width: 100%; min-height: 80px; padding: 10px; border-radius: 8px; border: 1px solid var(--border); margin-bottom: 12px; font-family: inherit; font-size:1rem; }
    .ai-modal-body button { width: 100%; background-color: var(--accent); color: var(--paper); padding: 12px; border: none; border-radius: 8px; font-size: 1rem; font-weight: 700; cursor: pointer;}
    .ai-modal-response { margin-top: 15px; padding: 12px; background: var(--box); border-radius: 8px; max-height: 30vh; overflow-y: auto; line-height: 1.6;}

    /* Impress√£o A4 */
    @page{ size:A4; margin:12mm; }
    @media print{
      body{background:#fff}
      header{background:#fff; box-shadow:none}
      .toolbar, .actions, .ai-explanation, .ai-assistant-trigger, .ai-modal-overlay {display:none!important}
      a[href]::after{content:""}
      .formula-inline { background-color: transparent; color: var(--ink); padding: 0; border-radius: 0; }
    }

    footer{ text-align:center; color:#fff; margin:22px 0; }
    .tip{ background:rgba(255,255,255,0.2); border-radius:10px; padding:12px; margin-top:12px; display:inline-block }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <h1><i class="fas fa-atom"></i> Revis√£o para Prova de F√≠sica B</h1>
      <p class="subtitle">Conceitos essenciais e quest√µes resolvidas passo a passo</p>
      <div class="exam-info">
        <div class="info-card"><h3><i class="fas fa-book"></i> Disciplina</h3><p>F√≠sica B</p></div>
        <div class="info-card"><h3><i class="fas fa-calendar"></i> Per√≠odo</h3><p>2¬∫ Trimestre</p></div>
        <div class="info-card"><h3><i class="fas fa-list-ol"></i> Quest√µes</h3><p>10 quest√µes</p></div>
        <div class="info-card"><h3><i class="fas fa-pen"></i> Formato</h3><p>Objetivas e c√°lculos</p></div>
      </div>
      <div class="toolbar">
        <button class="btn" onclick="window.print()">Imprimir para resolver</button>
      </div>
    </header>

    <div class="content">
      <section class="section">
        <h2><i class="fas fa-wave-square"></i> Ondas Mec√¢nicas vs. Eletromagn√©ticas</h2>
        <div class="concepts">
          <div class="concept-item"><span class="highlight">Ondas mec√¢nicas</span> requerem meio material (ex.: som).</div>
          <div class="concept-item"><span class="highlight">Ondas eletromagn√©ticas</span> propagam-se no v√°cuo (ex.: luz).</div>
          <div class="concept-item">Velocidade da luz no v√°cuo: <span class="formula-inline">$c = 3 \times 10^8$ m/s</span></div>
          <div class="concept-item">Fen√¥menos: reflex√£o, refra√ß√£o, interfer√™ncia, difra√ß√£o, absor√ß√£o.</div>
          <div class="concept-item">Som: onda <span class="highlight">longitudinal</span>; Luz: onda <span class="highlight">transversal</span>.</div>
        </div>
        <div class="ai-assistant-trigger">
            <button class="btn-ai-context" onclick="openAIAssistant('Ondas Mec√¢nicas vs. Eletromagn√©ticas')"><i class="fas fa-comment-dots"></i> Tirar D√∫vida com o Bot d'Avila</button>
        </div>
      </section>

      <section class="section">
        <h2><i class="fas fa-sun"></i> Espectro Eletromagn√©tico</h2>
        <div class="concepts">
          <div class="concept-item">Ordem (maior ‚Üí menor $\lambda$): R√°dio ‚Üí Micro-ondas ‚Üí <span class="highlight">Infravermelho</span> ‚Üí Vis√≠vel ‚Üí <span class="highlight">Ultravioleta</span> ‚Üí Raios X ‚Üí Gama</div>
          <div class="concept-item"><span class="highlight">No v√°cuo todas t√™m a mesma velocidade ($c$)</span></div>
          <div class="concept-item">Rela√ß√£o fundamental: <span class="formula-inline">$c=\lambda f$</span> (logo $\lambda$ e $f$ s√£o inversamente proporcionais)</div>
          <div class="concept-item">UV: maior $f$, menor $\lambda$; IR: menor $f$, maior $\lambda$</div>
        </div>
         <div class="ai-assistant-trigger">
            <button class="btn-ai-context" onclick="openAIAssistant('Espectro Eletromagn√©tico')"><i class="fas fa-comment-dots"></i> Tirar D√∫vida com o Bot d'Avila</button>
        </div>
      </section>

      <section class="section">
        <h2><i class="fas fa-fire-alt"></i> Calor e Temperatura</h2>
        <div class="concepts">
          <div class="concept-item"><span class="highlight">Calor</span>: energia em tr√¢nsito por diferen√ßa de temperatura (condu√ß√£o, convec√ß√£o, radia√ß√£o)</div>
          <div class="concept-item"><span class="highlight">Temperatura</span>: medida da agita√ß√£o t√©rmica; define sentido do fluxo (quente ‚Üí frio)</div>
          <div class="concept-item"><span class="highlight">Energia interna</span> aumenta com calor absorvido ou trabalho realizado <em>sobre</em> o sistema</div>
        </div>
        <div class="ai-assistant-trigger">
            <button class="btn-ai-context" onclick="openAIAssistant('Calor e Temperatura')"><i class="fas fa-comment-dots"></i> Tirar D√∫vida com o Bot d'Avila</button>
        </div>
      </section>

      <section class="section">
        <h2><i class="fas fa-tachometer-alt"></i> Termodin√¢mica</h2>
        <div class="concepts">
          <div class="concept-item"><span class="highlight">1¬™ Lei</span>: <span class="formula-inline">$\Delta U=Q-W$</span> (com $W>0$ feito <em>pelo</em> sistema)</div>
          <div class="concept-item"><span class="highlight">Ciclos</span>: <span class="formula-inline">$\Delta U=0$</span></div>
          <div class="concept-item"><span class="highlight">M√°quinas t√©rmicas</span>: <span class="formula-inline">$\eta=\dfrac{W}{Q_{\text{Quente}}}=1-\dfrac{Q_{\text{Frio}}}{Q_{\text{Quente}}}$</span></div>
        </div>
        <div class="ai-assistant-trigger">
            <button class="btn-ai-context" onclick="openAIAssistant('Termodin√¢mica e M√°quinas T√©rmicas')"><i class="fas fa-comment-dots"></i> Tirar D√∫vida com o Bot d'Avila</button>
        </div>
      </section>
    </div>

    <hr style="border:none; border-top:1px dashed rgba(255,255,255,0.6); margin:22px 0;" />

    <section class="section" style="background:#fff">
      <h2><i class="fas fa-list-check"></i> Exerc√≠cios de treino com autocorre√ß√£o</h2>
      <div id="exercise-list">
        <!-- Os exerc√≠cios ser√£o inseridos aqui pelo JavaScript -->
      </div>
    </section>

    <hr style="border:none; border-top:1px dashed rgba(255,255,255,0.6); margin:22px 0;" />

    <div class="content">
      <section class="section">
        <h2><i class="fas fa-equals"></i> F√≥rmulas em 15 segundos</h2>
        <div class="formula">
            $v=\lambda f$ &nbsp;&nbsp;|&nbsp;&nbsp; $T=\dfrac{1}{f}$ &nbsp;&nbsp;|&nbsp;&nbsp; $\Delta U=Q-W$ &nbsp;&nbsp;|&nbsp;&nbsp; $\eta=1-\dfrac{Q_{\text{Frio}}}{Q_{\text{Quente}}}$
        </div>
      </section>
      <section class="section">
        <h2><i class="fas fa-clipboard-check"></i> Checklist final</h2>
        <div class="concepts">
          <div class="concept-item">[ ] Usei <span class="formula-inline">$v=\lambda f$</span> e <span class="formula-inline">$T=1/f$</span></div>
          <div class="concept-item">[ ] Para EM no v√°cuo, considerei <span class="formula-inline">$v=c$</span></div>
          <div class="concept-item">[ ] Em ciclo t√©rmico, apliquei <span class="formula-inline">$\Delta U=0$</span></div>
          <div class="concept-item">[ ] Em rendimento, usei <span class="formula-inline">$W=\eta Q_{\text{Quente}}$</span></div>
        </div>
      </section>
    </div>

    <footer>
      <p>Revis√£o completa para a Prova de F√≠sica B ‚Äî 2¬∫ Trimestre</p>
      <p>Bons estudos e boa prova! <i class="fas fa-graduation-cap"></i></p>
      <div class="tip"><i class="fas fa-lightbulb"></i> Em m√∫ltipla escolha, elimine primeiro as alternativas claramente incorretas.</div>
    </footer>
  </div>

  <!-- Modal do Assistente de IA -->
  <div class="ai-modal-overlay" id="ai-assistant-modal">
    <div class="ai-modal-content" data-context="">
      <div class="ai-modal-header">
        <h3><i class="fas fa-robot"></i> Professor Virtual Bot d'Avila</h3>
        <button class="ai-modal-close" onclick="closeAIAssistant()">&times;</button>
      </div>
      <div class="ai-modal-body">
        <textarea id="ai-question-input" placeholder="Digite aqui sua pergunta sobre o t√≥pico..."></textarea>
        <button onclick="submitAIQuestion()">Enviar Pergunta</button>
        <div class="ai-modal-response" id="ai-modal-response-area">
          <p>Fa√ßa uma pergunta sobre o conte√∫do desta se√ß√£o para come√ßar.</p>
        </div>
      </div>
    </div>
  </div>


  <script>
    const exercises = [
        { question: "Quando uma onda retorna ao meio de origem ap√≥s atingir uma superf√≠cie, ocorre o fen√¥meno de:", options: { a: "refra√ß√£o.", b: "interfer√™ncia.", c: "reflex√£o.", d: "difra√ß√£o.", e: "polariza√ß√£o." }, answer: 'c', justification: "Reflex√£o √© o fen√¥meno em que a onda incide em uma superf√≠cie e retorna ao seu meio de propaga√ß√£o original." },
        { question: "Uma onda na qual as part√≠culas do meio vibram paralelamente √† dire√ß√£o de propaga√ß√£o √© denominada:", options: { a: "transversal.", b: "longitudinal.", c: "eletromagn√©tica.", d: "estacion√°ria.", e: "progressiva." }, answer: 'b', justification: "Em ondas longitudinais, como o som no ar, a vibra√ß√£o das part√≠culas ocorre na mesma dire√ß√£o do deslocamento da onda." },
        { question: "A radia√ß√£o eletromagn√©tica respons√°vel pelo aquecimento de corpos √† dist√¢ncia √©:", options: { a: "luz vis√≠vel.", b: "ultravioleta.", c: "micro-ondas.", d: "raios X.", e: "infravermelha." }, answer: 'e', justification: "A radia√ß√£o infravermelha, tamb√©m conhecida como 'onda de calor', √© a principal respons√°vel pela transfer√™ncia de energia t√©rmica por radia√ß√£o." },
        { question: "No v√°cuo, a velocidade de propaga√ß√£o de todas as ondas eletromagn√©ticas √©:", options: { a: "maior para o infravermelho que para o ultravioleta.", b: "maior para a luz vis√≠vel que para o infravermelho.", c: "igual para todas as faixas do espectro.", d: "dependente da amplitude da onda.", e: "inversamente proporcional √† frequ√™ncia." }, answer: 'c', justification: "Um postulado fundamental da f√≠sica √© que todas as ondas eletromagn√©ticas se propagam no v√°cuo com a mesma velocidade, a velocidade da luz ($c \\approx 3 \\times 10^8$ m/s)." },
        { question: "Assinale a alternativa que descreve corretamente um aspecto da Primeira Lei da Termodin√¢mica:", options: { a: "Trabalho e calor s√£o formas de transferir energia, mas n√£o alteram a energia interna.", b: "A energia interna de um sistema s√≥ pode diminuir quando ele realiza trabalho.", c: "Calor √© a energia transferida devido exclusivamente ao contato f√≠sico entre corpos.", d: "Temperatura mede diretamente o calor contido em um corpo.", e: "A varia√ß√£o da energia interna de um sistema √© igual ao calor recebido menos o trabalho realizado por ele." }, answer: 'e', justification: "A Primeira Lei da Termodin√¢mica ($\\Delta U = Q - W$) √© um princ√≠pio de conserva√ß√£o de energia. A energia interna ($\\Delta U$) de um sistema muda quando ele troca calor ($Q$) ou realiza/sofre trabalho ($W$)." },
        { question: "Em um ciclo t√©rmico fechado, um g√°s realiza um trabalho de 50 J. A varia√ß√£o de energia interna e o calor l√≠quido trocado no ciclo s√£o, respectivamente:", options: { a: "0 J e 50 J.", b: "50 J e 50 J.", c: "0 J e -50 J.", d: "50 J e 0 J.", e: "N√£o √© poss√≠vel determinar." }, answer: 'a', justification: "Em qualquer ciclo, o sistema retorna ao estado inicial, ent√£o a varia√ß√£o da energia interna ($\\Delta U$) √© sempre zero. Pela 1¬™ Lei, se $\\Delta U = 0$, ent√£o $Q = W$. Portanto, o calor l√≠quido trocado √© igual ao trabalho realizado, 50 J." },
        { question: "Uma m√°quina t√©rmica com rendimento de 25% rejeita 300 kJ para a fonte fria. O calor absorvido da fonte quente, em kJ, √©:", options: { a: "100", b: "200", c: "300", d: "400", e: "500" }, answer: 'd', justification: "O rendimento √© $\\eta = 1 - \\frac{Q_{\\text{Frio}}}{Q_{\\text{Quente}}}$. Substituindo os valores: $0,25 = 1 - \\frac{300}{Q_{\\text{Quente}}} \\Rightarrow \\frac{300}{Q_{\\text{Quente}}} = 0,75 \\Rightarrow Q_{\\text{Quente}} = \\frac{300}{0,75} = 400$ kJ." },
        { question: "Uma onda propaga-se a 340 m/s com frequ√™ncia de 85 Hz. O comprimento de onda, em metros, √©:", options: { a: "2", b: "4", c: "6", d: "8", e: "10" }, answer: 'b', justification: "Usando a equa√ß√£o fundamental da ondulat√≥ria $v = \\lambda f$, temos $\\lambda = \\frac{v}{f} = \\frac{340}{85} = 4$ m." },
        { question: "Uma onda peri√≥dica tem comprimento de onda de 12 m e frequ√™ncia de 0,5 Hz. A velocidade de propaga√ß√£o, em m/s, √©:", options: { a: "6", b: "12", c: "18", d: "24", e: "36" }, answer: 'a', justification: "Pela equa√ß√£o $v = \\lambda f$, calculamos $v = 12 \\times 0,5 = 6$ m/s." },
        { question: "O som e a luz s√£o ondas que transportam energia sem transporte de mat√©ria. A principal diferen√ßa entre eles √© que:", options: { a: "o som √© longitudinal e mec√¢nica, enquanto a luz √© transversal e eletromagn√©tica.", b: "ambos s√£o transversais, mas o som exige meio material.", c: "a luz √© longitudinal, e o som √© transversal.", d: "ambos s√£o eletromagn√©ticos, mas o som tem maior frequ√™ncia.", e: "a luz √© mec√¢nica, e o som √© eletromagn√©tico." }, answer: 'a', justification: "Esta √© a classifica√ß√£o fundamental: som precisa de um meio (mec√¢nica) e vibra na dire√ß√£o da propaga√ß√£o (longitudinal). Luz n√£o precisa de meio (eletromagn√©tica) e vibra perpendicularmente √† propaga√ß√£o (transversal)." }
    ];

    function loadExercises() {
        const list = document.getElementById('exercise-list');
        if (!list) return;
        let html = '';
        exercises.forEach((ex, index) => {
            html += `<div class="exercise-item"><p class="q"><span class="k">Q${index + 1}</span> ${ex.question}</p><div class="options-container" id="options-${index}">`;
            for (const key in ex.options) {
                html += `<label><input type="radio" name="q${index}" value="${key}">(${key.toUpperCase()}) ${ex.options[key]}</label>`;
            }
            html += `</div><div class="actions"><button class="btn-check" onclick="checkAnswer(${index})">Verificar Resposta</button><button class="btn-ai" onclick="askExerciseExplanation(${index})">Pedir Explica√ß√£o ao Bot d'Avila <i class="fas fa-robot"></i></button></div><div class="feedback" id="feedback-${index}"></div><div class="ai-explanation" id="ai-explanation-${index}" style="display:none;"></div></div>`;
        });
        list.innerHTML = html;
        if (window.MathJax) { MathJax.typesetPromise(); }
    }

    function checkAnswer(index) {
        const selected = document.querySelector(`input[name="q${index}"]:checked`);
        const feedbackDiv = document.getElementById(`feedback-${index}`);
        if (!selected) {
            feedbackDiv.innerHTML = 'Por favor, selecione uma alternativa.';
            feedbackDiv.className = 'feedback incorrect';
            return;
        }
        const isCorrect = selected.value === exercises[index].answer;
        if (isCorrect) {
            feedbackDiv.innerHTML = `<b>Correto!</b> ${exercises[index].justification}`;
            feedbackDiv.className = 'feedback correct';
        } else {
            const correctOptionText = exercises[index].options[exercises[index].answer];
            feedbackDiv.innerHTML = `<b>Incorreto.</b> A resposta certa √© a alternativa <b>${exercises[index].answer.toUpperCase()}</b>: "${correctOptionText}".<br><br><i>Justificativa:</i> ${exercises[index].justification}`;
            feedbackDiv.className = 'feedback incorrect';
        }
        if (window.MathJax) { MathJax.typesetPromise([feedbackDiv]); }
    }

    const apiQueue = [];
    let isApiBusy = false;
    const apiCooldown = 3000;

    function processApiQueue() {
        if (isApiBusy || apiQueue.length === 0) return;
        isApiBusy = true;
        const task = apiQueue.shift();
        task();
        setTimeout(() => { isApiBusy = false; processApiQueue(); }, apiCooldown);
    }

    function callAPI(prompt, outputElement) {
        outputElement.style.display = 'block';
        outputElement.innerHTML = '<p>Buscando resposta com o bot do professor d\'Avila... ü§ñ</p>';
        
        const encodedPrompt = encodeURIComponent(prompt);
        const url = `https://text.pollinations.ai/${encodedPrompt}`;

        fetch(url)
            .then(response => {
                if (!response.ok) throw new Error(`Erro na API: ${response.statusText}`);
                return response.text();
            })
            .then(text => {
                let processedText;
                if (text.toLowerCase().includes('sponsor')) {
                    processedText = '<p><b>Bot do Professor:</b> A resposta autom√°tica foi filtrada pelo sistema detector de erros. Tente novamente.</p>';
                } else {
                    processedText = text.replace(/\n/g, '<br>');
                }
                outputElement.innerHTML = processedText;
                if (window.MathJax) {
                    MathJax.typesetPromise([outputElement]);
                }
            })
            .catch(error => {
                console.error('Erro na API:', error);
                outputElement.innerHTML = '<p><b>Erro:</b> N√£o foi poss√≠vel contatar o bot. Verifique sua conex√£o ou tente mais tarde.</p>';
            });
    }

    function askExerciseExplanation(index) {
        const ex = exercises[index];
        const explanationDiv = document.getElementById(`ai-explanation-${index}`);
        const correctAnswerText = ex.options[ex.answer];
        const prompt = `Como um excelente professor de f√≠sica chamado d'Avila Bot, explique de forma did√°tica e concisa para um aluno de ensino m√©dio por que a resposta correta da quest√£o "${ex.question}" √© a alternativa "${ex.answer}) ${correctAnswerText}". Foque no conceito principal.`;
        
        apiQueue.push(() => callAPI(prompt, explanationDiv));
        processApiQueue();
    }

    const aiModal = document.getElementById('ai-assistant-modal');
    const aiQuestionInput = document.getElementById('ai-question-input');
    const aiResponseArea = document.getElementById('ai-modal-response-area');

    function openAIAssistant(context) {
        aiModal.style.display = 'flex';
        aiModal.querySelector('.ai-modal-content').dataset.context = context;
        aiQuestionInput.value = '';
        aiResponseArea.innerHTML = `<p>Voc√™ est√° estudando <b>${context}</b>. Fa√ßa uma pergunta sobre este t√≥pico.</p>`;
    }

    function closeAIAssistant() {
        aiModal.style.display = 'none';
    }

    function submitAIQuestion() {
        const userQuestion = aiQuestionInput.value.trim();
        const context = aiModal.querySelector('.ai-modal-content').dataset.context;
        if (!userQuestion) {
            aiResponseArea.innerHTML = "<p>Por favor, digite uma pergunta antes de enviar.</p>";
            return;
        }

        const prompt = `Voc√™ √© o d'Avila Bot, um Bot professor de f√≠sica gente boa e did√°tico. Um aluno est√° usando seu material de revis√£o para uma prova e tem uma d√∫vida sobre o t√≥pico "${context}". Responda √† seguinte pergunta do aluno de forma clara e direta: "${userQuestion}"`;

        apiQueue.push(() => callAPI(prompt, aiResponseArea));
        processApiQueue();
    }

    document.addEventListener('DOMContentLoaded', loadExercises);
  </script>
</body>
</html>
